# 実装計画

- [x] 1. pnpmモノレポ構成とプロジェクト基盤の構築
  - web-ui、mastra-agent、nlp-processor、bpmn-generator、shared-types、shared-utilsパッケージを含むpnpmワークスペース設定を作成
  - 各パッケージのTypeScript設定を初期化し、パッケージ間の適切な参照を設定
  - Biome linterとフォーマッターをモノレポ全体に設定し、統一されたコード品質を確保
  - モノレポ用のビルドスクリプトと開発環境をセットアップ
  - _要件: 3.1, 7.3_

- [x] 2. 共通型定義とユーティリティの実装
- [x] 2.1 コアBPMNデータモデルとインターフェースの作成
  - shared-typesパッケージにBPMNElement、ProcessDefinition、SequenceFlowなどの関連型を定義
  - BPMN構造の整合性チェック用バリデーションユーティリティを実装
  - 共通エラー型とレスポンスインターフェースを作成
  - _要件: 1.1, 2.1, 4.1_

- [x] 2.2 MastraのAI統合機能を使用
  - MastraフレームワークのビルトインAI機能を活用（OpenAI等の統合済み）
  - 独自のAIサービス実装は不要（Mastraが提供）
  - Mastraエージェント内でAI呼び出しを直接実装
  - _要件: 1.1, 3.1, 7.1_

- [ ] 3. プロンプトエンジニアリングとレスポンス解析サービスの開発
- [ ] 3.1 Mastra AI用プロンプト管理システムの実装
  - 日本語ビジネスプロセス説明を構造化データに変換する最適化されたプロンプトテンプレートを作成
  - プロセス要素（タスク、ゲートウェイ、フロー）抽出用の段階的プロンプト戦略を実装
  - プロンプトバリエーションとA/Bテスト機能を追加してMastraプレイグラウンドで最適化
  - プロンプト効果測定とバージョン管理システムを構築
  - _要件: 1.1, 1.2, 2.1_

- [ ] 3.2 AIレスポンス解析とバリデーションロジックの作成
  - Mastra AIからのJSON構造化レスポンスをBPMN要素に変換するパーサーを実装
  - 条件分岐（「もし〜なら」等）と並行処理（「同時に」等）の日本語パターン認識ロジックを作成
  - AIレスポンスの不完全性や曖昧性を検出し、再プロンプト戦略を実装
  - 抽出されたプロセス要素の妥当性検証と信頼度スコアリングシステムを構築
  - _要件: 2.1, 2.2, 2.3_

- [ ] 4. プロセス構造パーサーの構築
- [ ] 4.1 BPMN構造ビルダーの実装
  - 抽出された要素をBPMN構造に変換するProcessStructureParserクラスを作成
  - 要素を有効なBPMNフローに整理するbuildProcessStructureメソッドを実装
  - BPMN準拠と論理的整合性を確保するvalidateStructureメソッドを追加
  - 構造構築と検証の単体テストを作成
  - _要件: 1.2, 2.1, 2.2, 2.3_

- [ ] 4.2 BPMN図のレイアウト最適化の追加
  - 視覚的明瞭性のためにBPMN要素を配置するoptimizeLayoutメソッドを実装
  - 異なるゲートウェイタイプとフローパターン用の自動配置アルゴリズムを作成
  - 図要素の衝突検出と間隔最適化を追加
  - 様々なプロセス複雑度でのレイアウト最適化テストを作成
  - _要件: 1.3, 5.2_

- [ ] 5. BPMN生成サービスの作成
- [ ] 5.1 XMLとJSON出力生成の実装
  - BPMN 2.0標準準拠のgenerateXMLメソッドを持つBPMNGeneratorクラスを作成
  - 構造化BPMNデータを出力するgenerateJSONメソッドを実装
  - 出力管理用のタイムスタンプ付きファイル命名機能を追加
  - XMLとJSON生成精度の単体テストを作成
  - _要件: 4.1, 4.2, 4.4_

- [ ] 5.2 画像出力生成機能の追加
  - スケーラブルベクターグラフィックス出力用のgenerateSVGメソッドを実装
  - ラスター画像生成用のgeneratePNGメソッドを追加
  - 正確な図レンダリング用のBPMN可視化ライブラリと統合
  - 画像生成品質とフォーマット準拠のテストを作成
  - _要件: 4.3_

- [ ] 6. Mastraエージェント統合の開発
- [ ] 6.1 BPMN生成エージェントワークフローの作成
  - Mastraフレームワークを使用してBPMNGenerationAgentクラスを実装
  - NLP処理、構造解析、BPMN生成を統合するワークフローを作成
  - AIサービス障害用のエラーハンドリングと再試行ロジックを追加
  - 完全なエージェントワークフローの統合テストを作成
  - _要件: 3.1, 3.2, 7.1, 7.2_

- [ ] 6.2 Mastraプレイグラウンド統合の実装
  - 自然言語からBPMN変換のリアルタイムテスト用Mastraプレイグラウンドを設定
  - 中間処理ステップを可視化するデバッグ機能を追加
  - AIモデル性能向上用のプロンプト最適化インターフェースを作成
  - プレイグラウンド使用とデバッグワークフローのドキュメントを作成
  - _要件: 3.2, 7.1, 7.2, 7.3_

- [ ] 7. React Router v7 WebUIの構築
- [ ] 7.1 基本Webアプリケーション構造の作成
  - React Router v7ルーティング設定でReactアプリケーションをセットアップ
  - HomePage、GeneratePage、SamplesPage、EditPageコンポーネントを実装
  - ナビゲーションと適切なルーティングを含むレスポンシブレイアウトを作成
  - 基本UI機能のコンポーネントテストを作成
  - _要件: 5.1, 6.1_

- [ ] 7.2 自然言語入力インターフェースの実装
  - 日本語プロセス説明入力用のテキストエリアを持つInputPanelコンポーネントを作成
  - 入力検証とテキスト品質のユーザーフィードバックを追加
  - リアルタイム文字数カウントと入力ガイドラインを実装
  - 入力処理と検証のテストを作成
  - _要件: 5.1, 6.1_

- [ ] 7.3 BPMNビューアーとエディターの構築
  - 図表示用のbpmn-jsライブラリを使用してBPMNViewerコンポーネントを実装
  - 要素配置と編集用のドラッグ&ドロップ機能を追加
  - BPMN要素の追加、削除、変更用ツールバーを作成
  - ビューアー機能と編集機能のテストを作成
  - _要件: 5.2, 5.3_

- [ ] 8. サンプルプロセスと学習機能の追加
- [ ] 8.1 サンプルプロセスライブラリの作成
  - 事前定義された日本語ビジネスプロセス例を持つSampleSelectorコンポーネントを実装
  - 単純線形、条件分岐、並行実行パターンをカバーするサンプルプロセスを追加
  - 選択されたサンプルの即座生成機能を作成
  - サンプル選択と生成のテストを作成
  - _要件: 6.1, 6.2, 6.3_

- [ ] 8.2 出力とエクスポート機能の実装
  - 生成されたBPMNを複数フォーマットで表示するOutputPanelコンポーネントを作成
  - XML、JSON、SVG、PNGフォーマットのダウンロード機能を追加
  - タイムスタンプとプロセス識別を含むファイル命名を実装
  - エクスポート機能とファイルフォーマット精度のテストを作成
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [ ] 9. 全コンポーネントの統合とエンドツーエンド機能テスト
- [ ] 9.1 WebUIとMastraエージェントの接続
  - ReactフロントエンドとMastraエージェントバックエンド間のAPI統合を実装
  - BPMN生成プロセス用のローディング状態と進行インジケーターを追加
  - 生成失敗用のエラーハンドリングとユーザーフィードバックを作成
  - 完全なユーザーワークフローの統合テストを作成
  - _要件: 5.1, 5.3, 7.3_

- [ ] 9.2 包括的エラーハンドリングとユーザーエクスペリエンスの実装
  - 様々な失敗シナリオ用のユーザーフレンドリーなエラーメッセージを追加
  - 一時的なAIサービスエラー用の再試行メカニズムを実装
  - UI内にヘルプドキュメントと使用ガイドラインを作成
  - エラーシナリオと回復をカバーするエンドツーエンドテストを作成
  - _要件: 1.3, 5.3, 6.3_